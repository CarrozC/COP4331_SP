<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Sign Up</title> 
        <link href="css/signup.css" rel="stylesheet">    
        <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    </head>
    <body>
        <!-- Prompts for signing up -->
        <div id="form-container">
            <h1 class="form-title">Sign Up</h1>
            <div class="form-container">
                <form id="signup" class="input-form">
                    <input type="text" placeholder="First Name" id="signupFirstName" name="firstName" required>
                    <input type="text" placeholder="Last Name" id="signupLastName" name="lastName" required>
                    <input type="text" placeholder="Username" id="signupLogin" name="userName" required>
                    <input type="password" placeholder="Password" id="signupPassword" name="password" required>
                    <input type="password" placeholder="Confirm Password" id="signupPasswordConfirm" name="passwordConfirm" required>
                    <button class="buttons" id="signUpConfirm" type="button">Sign Up!</button>
                </form>
            </div>
            <div id="signupResult"></div> <!-- Added for result feedback -->
        </div>

        <!-- Place JavaScript just before the closing body tag -->
        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", function() {
                document.getElementById("signUpConfirm").addEventListener("click", function() {
                    let firstName = document.getElementById("signupFirstName").value;
                    let lastName = document.getElementById("signupLastName").value;
                    let login = document.getElementById("signupLogin").value;
                    let password = document.getElementById("signupPassword").value;
                    let passwordConfirm = document.getElementById("signupPasswordConfirm").value;

                    // Check if passwords match
                    if (password !== passwordConfirm) {
                        document.getElementById("signupResult").innerHTML = "Passwords do not match.";
                        document.getElementById("signupResult").style.color = "red";
                        return;
                    }

                    let tmp = { FirstName: firstName, LastName: lastName, Login: login, Password: password };
                    let jsonPayload = JSON.stringify(tmp);

                    let url = 'http://group30.xyz/LAMPAPI/SignUp.php';
                    console.log("API Request URL:", url);  // Log the URL to check

                    let xhr = new XMLHttpRequest();
                    xhr.open("POST", url, true);
                    xhr.setRequestHeader("Content-type", "application/json; charset=UTF-8");

                    try {
                        xhr.onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {
                                let jsonObject = JSON.parse(xhr.responseText);

                                if (jsonObject.error) {
                                    document.getElementById("signupResult").innerHTML = "Signup failed: " + jsonObject.error;
                                    document.getElementById("signupResult").style.color = "red";
                                    return;
                                }

                                // If successful, redirect to index or give feedback
                                window.location.href = "index.html";
                            }
                        };
                        xhr.send(jsonPayload);
                    } catch (err) {
                        document.getElementById("signupResult").innerHTML = err.message;
                        document.getElementById("signupResult").style.color = "red";
                    }
                });
            });
        </script>
    </body>
</html>
